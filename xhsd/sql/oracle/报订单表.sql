prompt Importing table demo_bdxx...
set feedback off
set define off
insert into demo_bdxx (YWBM, ZDDWBM, ZDDH, PZBM, ZDSL, FHSL, FHZK, ZKBJ, LRRQ, CLRQ, BZ, TS, ID_BDXX)
values ('01', '3306000004', '3306000004', '3075260', 5, 0, 5.0000, '0', to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), '电子:01270126', null, 'cb657bc7-5e7e-4f19-a781-df0ef6d89198');

insert into demo_bdxx (YWBM, ZDDWBM, ZDDH, PZBM, ZDSL, FHSL, FHZK, ZKBJ, LRRQ, CLRQ, BZ, TS, ID_BDXX)
values ('01', '3301270001', '3301270001', '3075260', 2, 0, 6.0000, '0', to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), '电子:01051886', null, '4a5d5aae-4be8-425e-a9d0-c623f346ba8c');

insert into demo_bdxx (YWBM, ZDDWBM, ZDDH, PZBM, ZDSL, FHSL, FHZK, ZKBJ, LRRQ, CLRQ, BZ, TS, ID_BDXX)
values ('01', '3309000003', '3309000003', '3852451', 3, 0, 5.0000, '0', to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), '电子:03654389', null, 'bf4690f2-16bd-491d-ba3b-6a681dc219dc');

insert into demo_bdxx (YWBM, ZDDWBM, ZDDH, PZBM, ZDSL, FHSL, FHZK, ZKBJ, LRRQ, CLRQ, BZ, TS, ID_BDXX)
values ('01', '3309000001', '3309000001', '3852451', 5, 0, 5.0000, '0', to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), '电子:03654390', null, '9d96deeb-a292-45c5-87ef-7bc8e0ddf070');

insert into demo_bdxx (YWBM, ZDDWBM, ZDDH, PZBM, ZDSL, FHSL, FHZK, ZKBJ, LRRQ, CLRQ, BZ, TS, ID_BDXX)
values ('01', '3302110001', '3302110001', '3852451', 2, 0, 6.0000, '0', to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), '电子:04179926', null, '1f992c47-ab77-44bc-ad91-15a94733136c');

insert into demo_bdxx (YWBM, ZDDWBM, ZDDH, PZBM, ZDSL, FHSL, FHZK, ZKBJ, LRRQ, CLRQ, BZ, TS, ID_BDXX)
values ('01', '3325270001', '3325270001', '3852451', 3, 0, 6.0000, '0', to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), '电子:02042692', null, 'e251557d-741d-4767-8def-93da0ae896c6');

insert into demo_bdxx (YWBM, ZDDWBM, ZDDH, PZBM, ZDSL, FHSL, FHZK, ZKBJ, LRRQ, CLRQ, BZ, TS, ID_BDXX)
values ('01', '3307830003', '3307830003', '1918367', 2, 0, 5.0000, '0', to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), '电子:02102266', null, '51dc86f3-a39d-42f9-89c3-4eaaf4d91002');

insert into demo_bdxx (YWBM, ZDDWBM, ZDDH, PZBM, ZDSL, FHSL, FHZK, ZKBJ, LRRQ, CLRQ, BZ, TS, ID_BDXX)
values ('01', '3303820001', '3303820001', '3075260', 5, 0, 5.0000, '0', to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), '电子:01274531', null, '438fd7b5-3393-46ce-9e5f-237d6298dfa8');

insert into demo_bdxx (YWBM, ZDDWBM, ZDDH, PZBM, ZDSL, FHSL, FHZK, ZKBJ, LRRQ, CLRQ, BZ, TS, ID_BDXX)
values ('01', '3301270001', '3301270001', '3075260', 10, 0, 6.0000, '0', to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), '电子:01051888', null, '60ead6a7-6525-4d24-9e97-848d0b78ed2c');

insert into demo_bdxx (YWBM, ZDDWBM, ZDDH, PZBM, ZDSL, FHSL, FHZK, ZKBJ, LRRQ, CLRQ, BZ, TS, ID_BDXX)
values ('01', '3301850004', '3301850004', '3075260', 5, 0, 5.0000, '0', to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), to_date('08-06-2017 09:26:47', 'dd-mm-yyyy hh24:mi:ss'), '电子:08186291', null, '46156ea9-26d4-435f-a1f1-e21ced0f2c66');

prompt Done.




-- Create table
create table DEMO_BDXX
(
  ywbm    VARCHAR2(2),
  zddwbm  VARCHAR2(10),
  zddh    VARCHAR2(10),
  pzbm    VARCHAR2(10),
  zdsl    NUMBER(6),
  fhsl    NUMBER(6),
  fhzk    NUMBER(8,4),
  zkbj    CHAR(1),
  lrrq    DATE,
  clrq    DATE,
  bz      VARCHAR2(200),
  ts      DATE,
  id_bdxx VARCHAR2(36)
)
tablespace NNC_DATA01
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 256K
    next 256K
    minextents 1
    maxextents unlimited
    pctincrease 0
  );
-- Add comments to the columns 
comment on column DEMO_BDXX.ywbm
  is '业务部门';
comment on column DEMO_BDXX.zddwbm
  is '征订单位编码';
comment on column DEMO_BDXX.zddh
  is '征订单号';
comment on column DEMO_BDXX.pzbm
  is '品种编码';
comment on column DEMO_BDXX.zdsl
  is '征订数量';
comment on column DEMO_BDXX.fhsl
  is '发货数量';
comment on column DEMO_BDXX.fhzk
  is '发货折扣';
comment on column DEMO_BDXX.zkbj
  is '折扣标识 0 顺加 1 固定';
comment on column DEMO_BDXX.lrrq
  is '录入日期';
comment on column DEMO_BDXX.clrq
  is '处理日期';
comment on column DEMO_BDXX.bz
  is '备注';
comment on column DEMO_BDXX.ts
  is 'TS时间戳';
comment on column DEMO_BDXX.id_bdxx
  is '报订单主键';
  
  
  --创建放单时的报订单数据视图
  
   CREATE OR REPLACE VIEW bdxx as
 select ywbm, bd.zddwbm as zddwbm, bd.zddh, pz.pzbm as pzbm,bd.zdsl,'0' as fhsl,bd.zkbj,
(case when bd.zkbj='0' then bd.fhzk
      when bd.zkbj='1' then (select kczk from demo_kcb kc where kc.pzbm=bd.pzbm )+bd.fhzk
       end) fhzk,
       bd.lrrq,
       bd.clrq,bd.ts
  from demo_bdxx bd
  left join demo_khxx kh
    on bd.zddwbm = kh.khbh
  left join demo_pzxx pz
    on bd.pzbm = pz.pzbm

